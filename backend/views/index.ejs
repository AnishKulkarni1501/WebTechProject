<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Matches</title>
</head>
<body>
    <h1>Next Matches</h1>
    <div id="matches"></div>

    <script>
        async function fetchMatches() {
            try {
                const response = await fetch('/next_match');
                const data = await response.json();
                
                if (data.matches) {
                    const matchesDiv = document.getElementById('matches');
                    data.matches.forEach((match, index) => {
                        const matchElement = document.createElement('div');
                        
                        const matchDate = new Date(match.match_date);
                        const formattedDate = matchDate.toLocaleDateString('en-GB');
                        
                        matchElement.innerHTML = `
                            <p><strong>${match.home_team}</strong> vs <strong>${match.away_team}</strong></p>
                            <p>Match Date: ${formattedDate}</p>
                            <p id="timeLeft-${index}">Time Left: Calculating...</p>
                            <hr>
                        `;
                        matchesDiv.appendChild(matchElement);

                        // Start countdown updates for this match
                        updateCountdown(matchDate, `timeLeft-${index}`);
                        setInterval(() => updateCountdown(matchDate, `timeLeft-${index}`), 1000);
                    });
                } else {
                    document.getElementById('matches').innerText = 'No upcoming matches found.';
                }
            } catch (error) {
                document.getElementById('matches').innerText = 'Error loading matches.';
            }
        }

        function updateCountdown(matchDate, elementId) {
            const now = new Date();
            const timeDifference = matchDate - now;

            const timeLeftElement = document.getElementById(elementId);

            if (timeDifference <= 0) {
                timeLeftElement.innerText = 'Match has started';
                return;
            }

            const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDifference / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((timeDifference / (1000 * 60)) % 60);
            const seconds = Math.floor((timeDifference / 1000) % 60);

            timeLeftElement.innerText = `Time Left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        // Fetch matches when the page loads
        window.onload = fetchMatches;
    </script>
</body>
</html>
